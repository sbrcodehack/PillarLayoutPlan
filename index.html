<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pillar Layout Plan</title>
  <style>
    body {
      font-family: Arial;
      text-align: center;
      margin: 0;
      padding: 0;
      background: #f0f0f0;
    }
    canvas {
      border: 1px solid #444;
      margin-top: 20px;
      background: white;
    }
    .controls {
      padding: 10px;
    }
    input {
      width: 200px;
      padding: 5px;
      margin: 5px;
    }
    button {
      padding: 8px 14px;
      margin: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Pillar Layout Plan</h2>
  <div class="controls">
    <div>
      North side spacing: <input id="north" value="10,10,10">
      South side spacing: <input id="south" value="10,10,10">
    </div>
    <div>
      East side spacing: <input id="east" value="10,10,10">
      West side spacing: <input id="west" value="10,10,10">
    </div>
    <br>
    <button onclick="drawLayout()">Update Layout</button>
    <button onclick="rotateLayout()">Rotate Clockwise</button>
    <button onclick="downloadImage()">Download as Image</button>
    <button onclick="resetLayout()">Reset</button>
  </div>
  <canvas id="layoutCanvas" width="900" height="900"></canvas>

  <script>
  let rotation = 0;

  function parseSpacing(input) {
    return input.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
  }

  function resetLayout() {
    document.getElementById("north").value = "10,10,10";
    document.getElementById("south").value = "10,10,10";
    document.getElementById("east").value = "10,10,10";
    document.getElementById("west").value = "10,10,10";
    rotation = 0;
    drawLayout();
  }

  function drawDimensionArrow(ctx, x1, y1, x2, y2, label, color = 'blue') {
    ctx.strokeStyle = color;
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();

    const angle = Math.atan2(y2 - y1, x2 - x1);
    const arrowSize = 10;
    ctx.beginPath();
    ctx.moveTo(x2, y2);
    ctx.lineTo(x2 - arrowSize * Math.cos(angle - Math.PI / 6), y2 - arrowSize * Math.sin(angle - Math.PI / 6));
    ctx.lineTo(x2 - arrowSize * Math.cos(angle + Math.PI / 6), y2 - arrowSize * Math.sin(angle + Math.PI / 6));
    ctx.closePath();
    ctx.fill();

    ctx.save();
    ctx.translate((x1 + x2) / 2, (y1 + y2) / 2);
    ctx.rotate(angle);
    ctx.fillStyle = "black";
    ctx.font = "12px Arial";
    ctx.fillText(label + " ft", 0, -6);
    ctx.restore();
  }

  function drawLayout() {
    const canvas = document.getElementById("layoutCanvas");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const spacing = {
      north: parseSpacing(document.getElementById("north").value),
      south: parseSpacing(document.getElementById("south").value),
      east: parseSpacing(document.getElementById("east").value),
      west: parseSpacing(document.getElementById("west").value)
    };

    const widthFt = Math.max(spacing.north.reduce((a, b) => a + b, 0), spacing.south.reduce((a, b) => a + b, 0));
    const heightFt = Math.max(spacing.east.reduce((a, b) => a + b, 0), spacing.west.reduce((a, b) => a + b, 0));
    const scale = 20;
    const width = widthFt * scale;
    const height = heightFt * scale;
    const startX = (canvas.width - width) / 2;
    const startY = (canvas.height - height) / 2;

    ctx.save();
    ctx.translate(canvas.width / 2, canvas.height / 2);
    ctx.rotate(rotation * Math.PI / 180);
    ctx.translate(-canvas.width / 2, -canvas.height / 2);

    // Draw boundary
    ctx.strokeStyle = "#000";
    ctx.strokeRect(startX, startY, width, height);

    // Compass directions
    ctx.fillStyle = "black";
    ctx.font = "16px Arial";
    ctx.fillText("North ↑", startX + width / 2 - 30, startY - 25);
    ctx.fillText("South ↓", startX + width / 2 - 30, startY + height + 40);
    ctx.fillText("West ←", startX - 60, startY + height / 2 + 5);
    ctx.fillText("East →", startX + width + 20, startY + height / 2 + 5);

    function drawSidePillars(spacingArr, isHorizontal, baseX, baseY, flip = false, offsetX = 0, offsetY = 0, labelOffset = 0) {
      let pos = 0;
      spacingArr.forEach((s, i) => {
        const x = isHorizontal
          ? baseX + (flip ? (width - pos * scale) : pos * scale)
          : baseX + offsetX;
        const y = isHorizontal
          ? baseY + offsetY
          : baseY + (flip ? (height - pos * scale) : pos * scale);

        // Draw larger square pillar
        ctx.fillStyle = "black";
        ctx.fillRect(x - 5, y - 5, 10, 10);

        // Spacing label
        if (s > 0) {
          const mx = isHorizontal
            ? baseX + (flip ? width - (pos + s / 2) * scale : (pos + s / 2) * scale)
            : x + 12 + labelOffset;
          const my = isHorizontal
            ? y + (offsetY < height / 2 ? -12 : 20)
            : baseY + (flip ? height - (pos + s / 2) * scale : (pos + s / 2) * scale);
          ctx.fillStyle = "black";
          ctx.font = "12px Arial";
          ctx.fillText(`${s} ft`, mx, my);
        }

        pos += s;

        if (i === spacingArr.length - 1) {
          const finalX = isHorizontal
            ? baseX + (flip ? (width - pos * scale) : pos * scale)
            : baseX + offsetX;
          const finalY = isHorizontal
            ? baseY + offsetY
            : baseY + (flip ? (height - pos * scale) : pos * scale);
          ctx.fillStyle = "black";
          ctx.fillRect(finalX - 5, finalY - 5, 10, 10);
        }
      });
    }

    drawSidePillars(spacing.north, true, startX, startY, false, 0, 0);
    drawSidePillars(spacing.south, true, startX, startY + height, false, 0, 0);
    drawSidePillars(spacing.west, false, startX, startY, false, 0, 0);
    drawSidePillars(spacing.east, false, startX + width, startY, true, 0, 0, 30);

    // Draw dimension arrows
    drawDimensionArrow(ctx, startX, startY - 30, startX + width, startY - 30, `${widthFt}`, "red");
    drawDimensionArrow(ctx, startX - 30, startY, startX - 30, startY + height, `${heightFt}`, "green");

    ctx.restore();
  }

  function rotateLayout() {
    rotation = (rotation + 90) % 360;
    drawLayout();
  }

  function downloadImage() {
    const canvas = document.getElementById("layoutCanvas");
    const tempCanvas = document.createElement("canvas");
    const ctx = tempCanvas.getContext("2d");

    tempCanvas.width = canvas.width;
    tempCanvas.height = canvas.height;

    ctx.fillStyle = "white";
    ctx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
    ctx.drawImage(canvas, 0, 0);

    const link = document.createElement("a");
    link.download = "layout.png";
    link.href = tempCanvas.toDataURL("image/png");
    link.click();
  }

  // Initial draw
 window.onload = function () {
  drawLayout();
};
</script>

</body>
</html>
